# 小说模块功能文档

> **版本说明**：小说模块是下一版本的主要更新内容，为用户提供完整的小说阅读体验。

---

## 目录

1. [如何触发小说 Tab](#1-如何触发小说-tab)
2. [接口返回格式](#2-接口返回格式)
3. [界面介绍](#3-界面介绍)
4. [详细操作说明](#4-详细操作说明)

---

## 1. 如何触发小说 Tab

小说 Tab 的显示是**动态判断**的，不是固定显示。只有当接口配置中存在"小说"类型的源时，小说 Tab 才会在底部导航栏中显示。

### 触发条件

接口配置中的数据源需要包含 `"类型": "小说"` 字段：

```json
{
  "sites": [
    {
      "key": "novel_source_1",
      "name": "笔趣阁",
      "api": "https://example.com/api/novel",
      "type": 3,
      "类型": "小说"
    }
  ]
}
```

### 兼容识别

除了 `"类型": "小说"` 字段，系统还支持以下识别方式：

- **类型字段**：`"小说"` 或 `"novel"`（不区分大小写）
- **名称包含**：`小说`、`[书]`、`书源`
- **key 包含**：`novel`、`book`

---

## 2. 接口返回格式

小说模块复用 T4 接口架构，支持 NodeJS、Python、JS、HTTP 多种源类型。

### 2.1 接口配置示例

```json
{
  "sites": [
    {
      "key": "biquge",
      "name": "笔趣阁",
      "api": "https://example.com/biquge.py",
      "type": 3,
      "类型": "小说",
      "ext": "{\"host\":\"https://www.biquge.com\"}"
    }
  ]
}
```

### 2.2 首页数据 (homeContent)

```json
{
  "class": [
    {"type_id": "1", "type_name": "玄幻"},
    {"type_id": "2", "type_name": "都市"},
    {"type_id": "3", "type_name": "言情"}
  ],
  "list": [
    {
      "vod_id": "12345",
      "vod_name": "斗破苍穹",
      "vod_pic": "https://example.com/cover.jpg",
      "vod_remarks": "连载中"
    }
  ],
  "filters": {
    "1": [
      {
        "key": "status",
        "name": "状态",
        "value": [
          {"n": "全部", "v": ""},
          {"n": "连载", "v": "1"},
          {"n": "完结", "v": "2"}
        ]
      }
    ]
  }
}
```

### 2.3 分类列表 (category)

```json
{
  "page": 1,
  "pagecount": 100,
  "limit": 20,
  "total": 2000,
  "list": [
    {
      "vod_id": "12345",
      "vod_name": "1234",
      "vod_pic": "https://example.com/cover.jpg",
      "vod_remarks": "第1234章"
    }
  ]
}
```

### 2.4 详情页 (detail)

```json
{
  "list": [
    {
      "vod_id": "12345",
      "vod_name": "1234",
      "vod_pic": "https://example.com/cover.jpg",
      "vod_actor": "11234",
      "vod_content": "小说简介...",
      "vod_remarks": "连载中",
      "type_name": "玄幻",
      "vod_play_from": "默认线路",
      "vod_play_url": "第1章$url1#第2章$url2#第3章$url3"
    }
  ]
}
```

**章节格式**：
- `vod_play_from`：线路名称，多线路用 `$$$` 分隔
- `vod_play_url`：格式为 `章节名$链接`，章节间用 `#` 分隔

### 2.5 搜索 (search)

```json
{
  "list": [
    {
      "vod_id": "12345",
      "vod_name": "1234",
      "vod_pic": "https://example.com/cover.jpg",
      "vod_remarks": "1234"
    }
  ]
}
```

### 2.6 章节内容 (play)

#### 推荐格式：`novel://` 协议

```json
{
  "url": "novel://{\"title\":\"第一章 少年萧炎\",\"content\":\"正文内容...\"}",
  "parse": 0
}
```

- `title`：章节标题
- `content`：正文内容

#### 兼容格式：纯文本/HTML

```json
{
  "url": "正文内容...",
  "parse": 0
}
```

或

```json
{
  "url": "<p>正文内容...</p>",
  "parse": 0
}
```

---

## 3. 界面介绍

### 3.1 小说首页

提供书源选择、分类浏览、筛选功能。

| 区域 | 功能 |
|------|------|
| 顶部栏 | 书源选择器、书架/历史/搜索入口 |
| 分类标签 | 横向滚动的小说分类 |
| 筛选按钮 | 多维度筛选（状态、排序等） |
| 小说列表 | 网格布局展示封面 |

**横竖屏适配**：竖屏标准布局，横屏左侧导航+右侧内容

### 3.2 小说详情页

| 区域 | 功能 |
|------|------|
| 封面区 | 模糊背景 + 封面 + 书籍信息 |
| 简介区 | 可展开/收起的小说简介 |
| 章节区 | 章节列表，支持正序/倒序 |
| 底部栏 | 收藏 + 开始阅读 |

### 3.3 阅读器

**阅读设置**：

| 设置项 | 范围 |
|--------|------|
| 字体大小 | 14-32px |
| 行高 | 1.4-2.5 倍 |
| 字间距 | -0.5-2.0 |
| 段间距 | 0-2.0 倍 |
| 边距 | 12-48px |
| 首行缩进 | 0/2/4 字符 |
| 字体 | 10+ 预设，支持下载 |

**阅读主题**：

- 浅色：羊皮纸、纯白、护眼绿、淡粉、淡蓝、米黄、薄荷
- 深色：夜间、墨绿、深蓝、深紫、纯黑

**背景纹理**：牛皮纸、羊皮纸、宣纸、木纹、布纹

**翻页模式**：滚动、左右滑动、覆盖翻页、仿真翻页

**其他功能**：TTS 语音朗读、自动翻页、书签、笔记高亮、屏幕常亮

### 3.4 书架

- 收藏小说展示
- 阅读进度显示
- 批量管理（长按编辑）

### 3.5 阅读历史

- 按日期分组（今天/昨天/本周/本月）
- 显示最后阅读章节
- 滑动删除、一键清空

### 3.6 搜索

- 关键词搜索
- 显示当前书源

---

## 4. 详细操作说明

### 4.1 切换书源

1. 点击首页左上角的书源选择器
2. 在弹出面板中选择书源
3. 自动重新加载数据

### 4.2 浏览小说

1. 选择分类（玄幻/都市/言情等）
2. 使用筛选功能精确查找
3. 向下滚动加载更多
4. 点击封面进入详情页

### 4.3 阅读小说

1. 在详情页点击「开始阅读」或选择章节
2. 阅读器操作：
   - **双击屏幕**：呼出/隐藏控制栏
   - **点击左侧/左滑**：上一页
   - **点击右侧/右滑**：下一页

### 4.4 PC 键盘控制

| 按键 | 功能 |
|------|------|
| `←` / `PageUp` | 上一页 |
| `→` / `PageDown` / `空格` | 下一页 |
| `↑` | 向上滚动（滚动模式） |
| `↓` | 向下滚动（滚动模式） |
| `Home` | 滚动到顶部 |
| `End` | 滚动到底部 |
| `音量+` | 上一页 |
| `音量-` | 下一页 |

### 4.5 控制栏

**顶部**：返回、章节名称、朗读

**底部**：进度滑块、目录、书签、笔记、主题、设置

### 4.6 收藏书架

- 详情页点击「收藏」
- 书架页快速访问

### 4.7 TTS 朗读

1. 点击顶部「朗读」按钮
2. 选择声音、调整语速
3. 开始朗读

### 4.8 阅读设置

点击底部「设置」：字体、行高、翻页模式、自动翻页、屏幕常亮

### 4.9 切换主题

点击底部「主题」：选择预设主题、背景纹理、跟随系统深色模式

---